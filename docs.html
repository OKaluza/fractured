<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8.1: http://docutils.sourceforge.net/" />
<title>Fractured Studio v0.5</title>
<style type="text/css">

body {
  font-family: 'Droid Sans',helvetica,arial,serif;
  font-size: 10pt;
  background: #ffe;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }


</style>
</head>
<body>
<div class="document" id="fractured-studio-v0-5">
<h1 class="title">Fractured Studio v0.5</h1>

<div class="section" id="introduction">
<h1>Introduction</h1>
<p>Fractured Studio is a fast GPU fractal renderer written in Javascript and WebGL/WebCL.</p>
<p>Originally it was a spare-time project to get my old fractal software running cross-platform and to render fractals on the GPU.
There're already lots of great fractal programs around but from my deranged perspective I'd miss out on most of the fun if I didn't write it myself.</p>
<p>This project was originally started in 2009 using Java and JOGL, then I heard about WebGL, got motivated again, and ported my work to HTML5, learning Javascript along the way.</p>
<p>The formula editor and renderer was finished in late 2010 and probably should have stopped there but then I got carried away with making it a studio workspace where I could store my work on a server and access it anywhere.</p>
<p>Now many lost weekends and evenings later it seems to finally have turned into a fairly full-featured app, so here it is - maybe someone will find it useful.</p>
<p><em>(NOTE: This documentation is a work in progress and not by any means complete)</em></p>
<div class="section" id="requirements">
<h2>Requirements</h2>
<ul class="simple">
<li>A modern browser supporting WebGL and HTML5 local storage (Only confirmed working with Firefox, Chrome &amp; Safari at this stage, Opera's WebGL is still causing me some problems)</li>
<li>A graphics card with up to date drivers that support OpenGL (or Direct3D via ANGLE on Windows)</li>
<li>Experimental WebCL support is also available, using the Nokia Research Firefox WebCL plugin: <a class="reference external" href="http://webcl.nokiaresearch.com/">http://webcl.nokiaresearch.com/</a> to try it, append /webcl to the url arguments (eg: <a class="reference external" href="http://fractured.ozone.id.au/webcl">http://fractured.ozone.id.au/webcl</a>)</li>
<li><em>Disclaimer</em> My development plaftorm is Linux and Firefox. Other platforms have not all been well tested yet but I'm working on it. Everything should work fine though (in theory).</li>
</ul>
</div>
</div>
<div class="section" id="workspace">
<h1>Workspace</h1>
<p>On first loading the app you should be presented with a workspace showing a basic rendering of the Mandelbrot set and the following user interface elements:</p>
<ul class="simple">
<li><em>Top Menu</em> containing the [Session] and [Fractal] menus and the [Draw] button</li>
<li><em>Palette</em> an editable gradient colour palette and background colour selection</li>
<li><em>Tools</em> the set of tabs and panels on the left where you are reading this help file, containing tools with complete control over the fractal formula being rendered, the tabs are [Parameters] [Formula] [Colour] [Info] and [Help]</li>
<li><em>Fractal Display</em> occupies the rest of the available browser window, showing the rendered fractal image.</li>
<li><em>Coordinates</em> at the bottom left, shows the current complex coordinate under the mouse pointer as you move it over the fractal display.</li>
</ul>
<div class="section" id="fractal-display">
<h2>Fractal Display</h2>
<p>This is the output of the fractal formula and parameters, showing a rendering of the selected fractal formula coloured using the selected colouring algorithms using the palette gradient.
This area of the screen is responsive to various mouse actions, many of which can be customised (see later section on editing mouse commands).</p>
<p>The default mouse actions are:</p>
<ul class="simple">
<li><em>Mouse scroll over fractal</em> zoom in and out</li>
<li><em>Left-click</em> centre fractal on coordinate clicked on</li>
<li><em>Left-click and drag</em> Select an area of the fractal to zoom in on</li>
<li><em>Right click (or control-click on a Mac)</em> switch between Mandelbrot set and Julia set at selected coordinate (coord under mouse)</li>
<li><em>Right-click and drag</em> scroll fractal (if larger than display window)</li>
<li><em>Shift + scroll</em> Rotate in 10 degree increments</li>
<li><em>Alt + scroll</em> Rotate in 1 degree increments</li>
<li><em>Shift + mouse move</em> Display a julia set preview as you move the mouse around a Mandelbrot set</li>
</ul>
</div>
<div class="section" id="coordinates">
<h2>Coordinates</h2>
<p>As you move the mouse over the fractal display the coordinates in the complex plane are displayed in the box at the bottom left of the window. These coordinates are used for many of the available mouse actions, switching between the Mandebrot and Julia sets for instance.</p>
</div>
<div class="section" id="palette">
<h2>Palette</h2>
<p>The palette editor allows selection of a number of colours forming a gradient which is used to colour the fractal display.
Each of the colours in the gradient is represented by a line and a slider tool, except for the start and end colours.</p>
<ul class="simple">
<li>The slider tools (image) can be dragged, adjusting the position of the colour in the gradient.</li>
<li>Clicking on the line below the slider opens the Colour Selector box allowing you to edit the colour.</li>
<li>Clicking elsewhere in the gradient also opens the Colour Selector box allowing you to add a new colour at the selected position.</li>
<li>The start and end colours can also be edited by clicking at the start/end of the gradient.</li>
<li>Right-clicking on a colour position marker deletes the colour from the gradient.</li>
</ul>
<div class="section" id="colour-selector">
<h3>Colour Selector</h3>
<p>A standard colour picker box which allows selection of the Saturation and Brightness of the colour using the large square box to the left and the Hue and Opacity using the columns to the right.</p>
<ul class="simple">
<li>The box can be moved around by clicking and dragging on its edges.</li>
<li>To accept changes to the colour, press the [OK] button and the box will close.</li>
<li>To cancel the changes press the [X] button.</li>
</ul>
</div>
</div>
<div class="section" id="tools">
<h2>Tools</h2>
<p>The majority of the controls used to control the fractal rendering appear in the set of tabs on the left, which we will call the &quot;Tools&quot; area.</p>
<div class="section" id="parameters">
<h3>Parameters</h3>
<p>The first is the Parameters tab. This shows basic details of the fractal display, common to all fractal renderings regardless of chosen formula. All of these fields can be edited and changing most of them will modify the way the fractal is rendered. To redraw the fractal after changing a value, press the [Draw] button on the Top Menu.
The fields are:</p>
<ul class="simple">
<li><em>Name</em> a name for the fractal, used when saving</li>
<li><em>Fit to window</em> when checked the fractal display will take up all available window space and will be automatically adjusted when the window is resized.</li>
<li><em>Size</em> width and height dimensions of the fractal display window, uncheck Fit to window when using this to set width and height.</li>
<li><em>Zoom</em> factor of magnification used when displaying the fractal, the [Reset] button returns this value to the default (0.5)</li>
<li><em>Rotate</em> degrees of rotation to apply</li>
<li><em>Origin</em> complex coordinate at the centre of the fractal display</li>
<li><em>Selected</em> complex coordinate selected for use in rendering Julia Sets and the Perturb option.</li>
<li><em>Julia</em> when checked indicates Julia Set mode, plotting a Julia Set at the selected coord.</li>
<li><em>Perturb</em> when checked indicates applying the selected coord as a perturbation of the rendered fractal (the value is added with every iteration of the formula)</li>
<li><em>Iterations</em> maximum number of iterations to apply the selected formula</li>
</ul>
</div>
<div class="section" id="formula">
<h3>Formula</h3>
<p>This is where we start to really gain control of the fractal space to render.
The first three options here allow selection of different <em>Formulae</em> used to generate the fractal.</p>
<ul class="simple">
<li><em>Fractal</em> this is the most important of all, the actual fractal formula. This is controls the equation that is iterated multiple times until either the maximum iterations value is reached or the resulting value escapes above a set value or converges below a set value. A number of predefined formulae are offered which you can edit or even create your own (see <em>Formula Editing</em>)</li>
<li><em>Pre-Transform</em> this is an optional formula that will be applied every iteration before the fractal formula.</li>
<li><em>Post-Transform</em> this is an optional formula that will be applied every iteration after the fractal formula.</li>
</ul>
<p>When a formula is selected, it usually has a number of parameters you can edit to control its behaviour.
These will appear below the formula selections.</p>
<p>Each formula will have different options which are best understood by playing with the values and seeing the effect they have, but we will go over the parameters for the basic Mandelbrot set here as an example:</p>
<ul class="simple">
<li><em>z(n+1)</em> is the core of the formula itself, the expression that will be calculated every iteration. Two special values to note here, <em>z</em> is the complex variable we are applying the formula to, <em>c</em> is an additional complex variable, representing either the current pixel coordinate (Mandelbrot sets) or a constant selected coordinate (Julia sets). Each iteration (n) we apply the formula to get the next value (n+1). The basic Mandelbrot set formula is z = z^2+c, our example here is z^p+c, <em>p</em> is the power to raise <em>z</em> to, described below.</li>
<li><em>p</em> is an additional parameter we have defined allowing us to control the power. This builds an additional dimension of flexibility into the formula definition, essentially providing many different possible types of fractal to be rendered by simply changing a parameter value, rather than having to edit the formula.</li>
<li><em>Escape</em> is the value which controls the <em>Bailout</em> condition, if this condition is met the fractal calculation is finished.</li>
<li><em>Bailout Test</em> is the test to apply to <em>z</em> to see if it meets the bailout value <em>Escape</em>. By default here it is <em>norm</em> so the coordinate will be considered outside the set if this condition is ever true: norm(z) &gt; <em>escape</em> which is equivalent to norm(z) &gt; 4.</li>
</ul>
<p>The default <em>Fractal</em> formula list contains <em>Mandelbrot, Burning Ship, Magnet 1,2 &amp; 3, Nova, Cactus &amp; Phoenix</em> fractal formulae.
The default <em>Transform</em> formula list contains two simple transforms: <em>Inverse</em> (which only works as a pre-transform) and <em>Functions</em> which simply applies a mathematical function to the result of the selected formula at every iteration.</p>
</div>
<div class="section" id="colour">
<h3>Colour</h3>
<p>Additional formulae can be selected controlling how the values calculated by iterating the fractal formula above are used to colour the resulting image.
These formulae usually derive a colour from the gradient palette, but may calculate a colour value directly, ignoring the gradient.</p>
<p>The default <em>Colour</em> formula lists contains <em>Default, Smooth, Exponential Smoothing, Triangle Inequality, Orbit Traps, Gaussian Integers and Hot &amp; Cold</em> colouring algorithms.</p>
<p>There are also entries for <em>None</em> - disabling colouring in the selected area, and <em>As Above</em> (for Inside Colour only) which indicates the same colouring parameters will be used for inside colour as the selected outside colour method.</p>
</div>
<div class="section" id="info">
<h3>Info</h3>
<p>This tab shows a log of status information and sometimes error messages from the fractal renderer.</p>
<p>The [Clear Log] button clears all messages from the display.</p>
<p>There is also a <em>Local storage usage</em> indicator showing how much of the available local storage allocation is available, this is filled by saving fractals and when exceeded no more will be able to be saved. Currently it is based on an assumption of 5MB local storage space.</p>
</div>
<div class="section" id="help">
<h3>Help</h3>
<p>Hmmmm.... whatever could this be for??</p>
</div>
</div>
<div class="section" id="top-menu">
<h2>Top Menu</h2>
<p>Now we get to the menu bar which has various options controlling fractal rendering and allowing saving and loading fractals and other data to local storage and to the web server.</p>
<div class="section" id="draw">
<h3>Draw</h3>
<p>This button redraws the current fractal, changes to fractal parameters in the <em>tools</em> area are not usually applied instantly and you must press this button to redraw the fractal display.</p>
</div>
<div class="section" id="fractal">
<h3>Fractal</h3>
<p>This menu contains features relating to the current fractal display:</p>
<ul class="simple">
<li><em>New</em> Create a new fractal and reset all fractal settings to defaults.</li>
<li><em>Save</em> stores the current fractal in local storage using the name entered in the <em>parameters</em> tab. If the name is already used you will be asked if you'd like to overwrite the existing entry.</li>
<li><em>Share</em> Upload a fractal to the server, optionally can be published on the site. Responds with a unique URL that can be used to load this fractal.</li>
<li><em>Saved Fractals</em> displays a sub-menu of all the saved fractals, with thumbnail images if available. Clicking on one of these saved entries loads that fractal and displays it. After loading a fractal it will be selected in this list and a [ X ] button appears which can be used to delete the fractal from the list.</li>
<li><em>Formula Sets</em> sub-menu of available saved formula sets and options relating to them.</li>
<li><em>Save As...</em><ul>
<li><em>JPEG Image</em> / <em>PNG Image</em> downloads the fractal image display as an image file.</li>
<li><em>Fractal File</em> export and download the current fractal parameters and formula as a fractal data text file.</li>
<li><em>Fractal URL</em> export and download the current fractal parameters and formula as self-contained URL with all the information necessary to display the fractal.</li>
</ul>
</li>
<li><em>Import</em> select and upload a previously exported data file, can select importing of a fractal, palette or formula file.</li>
<li><em>Anti-aliasing</em> select the anti-aliasing quality to use when rendering fractals.</li>
<li><em>Script Editor</em> an experimental feature allowing you to write a javascript that controls the fractal display.</li>
<li><em>Clear Actions</em> clears any saved custom mouse actions from storage.</li>
<li><em>Hide/Show Tools</em> hides or shows the <em>tools</em> area from the window, allowing more room for the fractal display.</li>
</ul>
</div>
<div class="section" id="session">
<h3>Session</h3>
<p>This menu gives you options over the current <em>session</em> data, a <em>session</em> represents all the currently saved fractals and formula stored in local storage. This data can be stored on the server and then retrieved from another browser on another computer. It also allows more fractal files to be saved that would otherwise fit in the allocated local storage space, if you run low on space you can just save your session to the server and start a new session.</p>
<p>In order to use the server features you must log in, you can use any OpenID provider account to log in, Google, Yahoo, myOpenID, AOL and StackExchange account options are provided on the menu, others are supported by selecting the top <em>OpenID</em> option.</p>
<ul class="simple">
<li><em>New</em> clears the session data and creates a new session, this will delete any saved fractals and formulae, make sure you have exported or uploaded your session data before you do this!</li>
<li><em>Save</em> (when logged in only) saves the current set of saved fractals and formula as a session entry on the server, if the current session was previously saved allows saving over the previous data. If not you will be prompted for a description for the session.</li>
<li><em>Export</em> download a data file containing all the data in the current session.</li>
<li><em>Import</em> upload a previously saved data file containing all the data for a session, which will replace the current session (also clears all data, make sure you have saved anything you want to keep!).</li>
<li><em>Login with</em> shows the OpenID login options if not already logged in. Allows you to use an OpenID provider to log in and save sessions, formula sets and fractals on the server.</li>
<li><em>Saved Sessions</em> (when logged in only) shows a list of saved session associated with the logged in account that have been stored on the server. Clicking on one of these allows loading all the session data and replacing the current session. If a session from this list is active it will be outlined and a [ X ] delete button will be shown to allow you to remove the saved session and delete all its data from the server.</li>
<li><em>Logout</em> (when logged in only) log out from the server. An option to clear the session data will be given, if taken the session will be replaed by a new session.</li>
</ul>
</div>
</div>
<div class="section" id="formula-sets">
<h2>Formula Sets</h2>
<p>The Formula Sets menu under the Fractal menu has a set of features allowing you to save and restore sets of formula for later use or sharing.
The first two menu options <em>Public</em> and <em>Uploaded</em> contain formula sets on the server which you can choose to load.
Selecting one of the names formula sets from either of these sub-menus will prompt you to download and use this formula set.
<em>Warning</em> loading a formula set will replace all your active formula definitions.
Once you have loaded a formula set from the server it will be highlighted in the menu with a grey border and a [ X ] delete button will be available if you wish to remove the formula set from the server.</p>
<ul class="simple">
<li>The <em>Public</em> list is all formula sets that yourself or others have published on the server.</li>
<li>The <em>Uploaded</em> list contains only your own formula sets that you have uploaded.</li>
<li>The <em>Publish</em> option will upload your current formula set and make it available for all users.</li>
<li>The <em>Upload</em> option will save your current formula set on the server but only you will be able to access it later.</li>
</ul>
</div>
</div>
<div class="section" id="editing-formulae">
<h1>Editing Formulae</h1>
<p>There are limitless possibilities here to define your own fractal, transform and colour formulae.
Each formula selection has three buttons to the right:</p>
<ul class="simple">
<li>The [Edit] button opens an editor allowing you to modify the formula code.</li>
<li>The [ + ] button allows you to add a new formula definition, after you enter a name the editor will open with the currently selected formula code as a starting point.</li>
<li>The [ - ] button deletes a formula from the list.</li>
</ul>
<p>A formula definition consists of a set of parameter definitions and (optionally) data declarations and a set of formula code sections.</p>
<div class="section" id="parameter-definitions">
<h2>Parameter definitions</h2>
<p>A parameter definition is a description of a formula variable or option which you want to allow to be controlled by the user interface.
These definitions specify the controls that appear when you select this formula.</p>
<p>The format of a definition is:</p>
<pre class="literal-block">
//Description
&#64;variable_name = type(default);
</pre>
<ul class="simple">
<li><em>&#64;</em> Indicates to the formula parser that this is a parameter definition, must start with this symbol.</li>
<li><em>Description</em> Enter the information you want to appear in the control label in this comment area on the line before the actual definition. This description can be left out, in which case the variable name will be used as a label instead.</li>
<li><em>variable_name</em> Enter a variable name (containing only the characters a-z, A-Z, 0-9 and underscore _, must not start with a number) this is the name by which you will use this parameters value in the formula code.</li>
<li><em>type</em> the type of value: bool, int, uint, real, float, complex, rgba, list, real_function, complex_function, bailout_function or expression</li>
<li><em>default</em> the default value that is inserted for the parameter if it has not been edited.</li>
</ul>
<p><strong>Parameter types explained</strong></p>
<ul class="simple">
<li><em>bool</em> a true/false value, appears as a check box</li>
<li><em>int</em> an integer value, appears as a number entry</li>
<li><em>uint</em> an unsigned integer value ( &gt; 0), appears as a number entry</li>
<li><em>real</em> a real number, appears as a number entry</li>
<li><em>float</em> as above, but single precision only regardless of precision setting</li>
<li><em>complex</em> a complex number value, represented as a real and imaginary value seperated by a comma in code, appears as two number entries.</li>
<li><em>rgba</em> a colour value, appears as a colour box which can be clicked on to bring up a colour picker</li>
<li><em>list</em> a list of labels, the variable will be assigned a numeric value based on user selection from 0 to n-1 (where n is number of list items), appears as a drop down list.</li>
<li><em>real_function</em> a drop down list of functions returning real number values</li>
<li><em>complex_function</em> a drop down list of functions returning complex number values</li>
<li><em>bailout_function</em> a drop down list of bailout functions</li>
<li><em>expression</em> a mathematical expression that will be parsed and converted into formula code</li>
</ul>
</div>
<div class="section" id="data-declarations">
<h2>Data declarations</h2>
<p>Following the parameter definitions a list of data variables that will be used in the formula calculation can be defined, in the form:</p>
<pre class="literal-block">
type variable_name = default;
</pre>
<ul class="simple">
<li><em>type</em> can be one of bool, int, uint, real, float, complex or rgba.</li>
<li><em>variable_name</em> a standard variable name (containing only the characters a-z, A-Z, 0-9 and underscore _, must not start with a number)</li>
<li><em>default</em> initial value of variable, complex numbers can be specificed simply using parentheses, eg: (0.3,0.3)</li>
</ul>
</div>
<div class="section" id="formula-code-sections">
<h2>Formula code sections</h2>
<p>These are sections of code that will be processed in various points during the fractal calculation, different sections are available depending on the type of formula being edited.</p>
<p>They are defined in the form:</p>
<pre class="literal-block">
section:
  code statements...
  ...
</pre>
<p><em>section</em> is the name of the section, on the following line you enter the formula code, it doesn't have to be indented but doing so will make it easier to read. Any statements from the preceding section heading until the next section heading or the end of the file will be interpreted as the section contents.</p>
<div class="section" id="common-sections">
<h3>Common sections</h3>
<ul class="simple">
<li><em>init:</em> inserted after data declarations, before all processing.</li>
<li><em>reset:</em> inserted after setting up the initial conditions of the formula, selected starting coordinates etc.</li>
</ul>
</div>
<div class="section" id="fractal-formulae-sections">
<h3>Fractal Formulae sections</h3>
<ul class="simple">
<li><em>znext:</em> the calculation of the next z value, z(n+1), the core of the fractal formula processing. To define a fractal formula that does anything this section must be defined, but it may be defined as a <em>parameter</em> of type <em>expression</em> named znext, which will simply execute the code resulting from the entered mathematical expression in this code section. Otherwise you must define the znext section, you can define znext as a parameter or a code section but not both.</li>
<li><em>escaped:</em> define an escape bailout test, if <strong>break</strong> is called here the fractal iteration halts and the escape condition will be set. This section can also be replaced by a parameter named &quot;escape&quot; containing a numeric value (which will be used with a default bailout function) or an expression (which will bailout if it evaluates to true).</li>
<li><em>converged:</em> define a convergent bailout test, as escape except when triggered the converge condition will be set. This section can also be replaced by a parameter named &quot;converge&quot; containing a numeric value (which will be used with a default bailout function) or an expression (which will bailout if it evaluates to true).</li>
</ul>
</div>
<div class="section" id="transform-formulae-sections">
<h3>Transform Formulae sections</h3>
<ul class="simple">
<li><em>transform:</em> code entered here will be inserted at the fractal z(n+1) calculation stage, before processing znext if it is a pre-transform, or after if it is a post-transform.</li>
</ul>
</div>
<div class="section" id="colour-formulae-sections">
<h3>Colour Formulae sections</h3>
<ul class="simple">
<li><em>calc:</em> code entered here will be inserted after the fractal z(n+1) calculation stage, use for any additional values that must be calculated during the fractal iteration to be used in the final colour calculation.</li>
<li><em>result:</em> this is where the final colour is calculated, set the built in variable <strong>colour</strong> to the value desired. This must be an rgba value, the colours of the editable gradient can be accessed using the function <strong>gradient(value)</strong> where value is a number between 0 and 1 representing the position on the gradient to sample, this function returns an rgba colour value.</li>
</ul>
</div>
</div>
<div class="section" id="formula-language">
<h2>Formula language</h2>
<p>Apart from the special format of the parameter definitions and section headers, the formula code is entered in a C-style syntax as a form of augmented GLSL ES 2.0 (<a class="reference external" href="http://www.khronos.org/opengles/2_X">http://www.khronos.org/opengles/2_X</a>) with an additional function library for complex numbers and some definitions and pre-processing for ease of use writing fractal formulae.</p>
<p>Complex numbers are represented as two-dimensional vector types, and created using the type <em>complex</em>, complex constants can be defined in code in the form (re, im), eg: complex Z = (-1,0.5). You can then access the real component (-1.0) as Z.x and the imaginary component (0.5) as Z.y.</p>
<p>This is a bit of a hack and you need to be aware that arithmetic operations on GLSL vector types operate component wise, this works nicely for some operations for which the complex number definition is the same (addition and subtraction) but not for multiplication and division. As operators can't be overloaded in GLSL, for mathematically correct results you should never use the * and / operators to multiply and divide complex types. Use the built in <em>mul()</em> and <em>div()</em> functions instead which are designed to do correct complex number multiplication and division.</p>
<pre class="literal-block">
eg: if x is a complex number:
x = x*(1.5,-1); -- incorrect!
x = mul(x,(1.5,-1)); -- correct!
</pre>
<p>For mathematical expressions it is much better using the <strong>expression</strong> parameter type, expressions entered in these parameters will multiply complex numbers correctly using the * and / operators and result in much more readable mathematical language, with the bonus that the expression can be easily edited in the tools panel without having to open the formula editor.
The expression parser will automatically translate any multiplication, division and power operations to the correct form.</p>
<p><strong>Note: Colour and Transform formulae</strong>
As the same colour and transform formula can be selected twice in different categories, variables and parameters declared in these formula can cause conflicts (attempting to declare a variable or parameter of the same name twice).</p>
<p>To get around this you can use the colon &quot;:&quot; character at the start of any variable or after the &#64; in a parameter name. When the formula code is translated to shader code the &quot;:&quot; will be replaced with the formula type, preventing &quot;redefinition&quot; errors.</p>
<pre class="literal-block">
eg: &#64;myparam = real(1);
or: complex x = (4,5);
can be replaced respectively by
&#64;:myparam = real(1);
complex :x = (4,5);
</pre>
<p>If the above is not followed in a colour formula, for example, and this colour formula is selected for both inside and outside colouring, you will get errors of the form:</p>
<pre class="literal-block">
(ERROR: 0:180: 'myparam' : redefinition).
(ERROR: 0:182: 'x' : redefinition).
</pre>
<p><strong>TODO: Further document maths library functions, custom mouse actions, scripting, default formulae</strong></p>
</div>
</div>
</div>
</body>
</html>
