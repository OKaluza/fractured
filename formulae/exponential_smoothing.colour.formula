//Exponential smoothing
//Palette repeat
@:repeat = real(1);
//Divergent
@:diverge = bool(true);
//Convergent
@:converge = bool(false);

real :sum = 0.0;
real :csum = 0.0;

calc:
  if (:diverge)
    :sum += exp(-cabs(z));

  if (:converge)
    :csum += exp(-1.0/cabs(z_1 - z));  

result:
  real mu = :sum;
  if (!:diverge || :converge && converged)
    mu =  :csum;
    
  colour = gradient(:repeat * mu / real(limit));

